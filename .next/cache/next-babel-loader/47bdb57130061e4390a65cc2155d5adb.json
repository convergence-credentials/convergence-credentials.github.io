{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nvar __jsx = React.createElement;\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport connectToChild from \"penpal/lib/connectToChild\";\nimport { getData, obfuscateDocument } from \"@govtechsg/open-attestation\";\nimport { get } from \"lodash\";\nimport { getCertificate, getActiveTemplateTab, updateObfuscatedCertificate as _updateObfuscatedCertificate, registerTemplates as registerTemplatesAction, selectTemplateTab as selectTemplateTabAction } from \"../../reducers/certificate\";\nimport { analyticsEvent } from \"../Analytics\";\nimport styles from \"../certificateViewer.scss\";\nimport { getDocumentIssuerStores } from \"../../utils/certificate\";\n\nvar DecentralisedRenderer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(DecentralisedRenderer, _Component);\n\n  function DecentralisedRenderer(props) {\n    var _this;\n\n    _classCallCheck(this, DecentralisedRenderer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DecentralisedRenderer).call(this, props));\n    _this.state = {\n      childFrameConnection: null\n    };\n    return _this;\n  }\n\n  _createClass(DecentralisedRenderer, [{\n    key: \"selectTemplateTab\",\n    value: function () {\n      var _selectTemplateTab = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(i) {\n        var childFrameConnection, child;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                childFrameConnection = this.state.childFrameConnection;\n                _context.next = 3;\n                return childFrameConnection;\n\n              case 3:\n                child = _context.sent;\n                _context.next = 6;\n                return child.selectTemplateTab(i);\n\n              case 6:\n                this.props.selectTemplateTab(i);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function selectTemplateTab(_x) {\n        return _selectTemplateTab.apply(this, arguments);\n      }\n\n      return selectTemplateTab;\n    }()\n  }, {\n    key: \"updateHeight\",\n    value: function updateHeight(h) {\n      this.iframe.height = h;\n    }\n  }, {\n    key: \"updateTemplates\",\n    value: function updateTemplates(templates) {\n      if (!templates) return;\n      this.props.registerTemplates(templates);\n    }\n  }, {\n    key: \"handleObfuscation\",\n    value: function handleObfuscation(field) {\n      var updatedDocument = obfuscateDocument(this.props.document, field);\n      this.props.updateObfuscatedCertificate(updatedDocument);\n      var updatedCertificate = getData(updatedDocument);\n      this.renderDocument(updatedCertificate);\n    }\n  }, {\n    key: \"renderDocument\",\n    value: function () {\n      var _renderDocument = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(certificate) {\n        var childFrameConnection, child;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                childFrameConnection = this.state.childFrameConnection;\n                _context2.next = 3;\n                return childFrameConnection;\n\n              case 3:\n                child = _context2.sent;\n                _context2.next = 6;\n                return child.renderDocument(certificate);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function renderDocument(_x2) {\n        return _renderDocument.apply(this, arguments);\n      }\n\n      return renderDocument;\n    }() // Do not re-render component if only activeTab changes\n\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.activeTab !== nextProps.activeTab && this.props.document === nextProps.document) {\n        this.selectTemplateTab(nextProps.activeTab);\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var iframe = this.iframe;\n      var updateHeight = this.updateHeight.bind(this);\n      var updateTemplates = this.updateTemplates.bind(this);\n      var handleObfuscation = this.handleObfuscation.bind(this);\n      var childFrameConnection = connectToChild({\n        iframe: iframe,\n        methods: {\n          updateHeight: updateHeight,\n          updateTemplates: updateTemplates,\n          handleObfuscation: handleObfuscation\n        }\n      }).promise;\n      this.setState({\n        childFrameConnection: childFrameConnection\n      });\n      childFrameConnection.then(function (frame) {\n        return frame.renderDocument(getData(_this2.props.certificate));\n      });\n      var certificateData = getData(this.props.certificate);\n      analyticsEvent(window, {\n        category: \"CERTIFICATE_VIEWED\",\n        action: getDocumentIssuerStores(certificateData),\n        label: get(certificateData, \"id\")\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(\"iframe\", {\n        title: \"Decentralised Rendered Certificate\",\n        id: \"iframe\",\n        className: styles[\"decentralised-renderer\"],\n        ref: function ref(iframe) {\n          _this3.iframe = iframe;\n        },\n        src: this.props.source\n      });\n    }\n  }]);\n\n  return DecentralisedRenderer;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    document: getCertificate(store),\n    activeTab: getActiveTemplateTab(store)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    updateObfuscatedCertificate: function updateObfuscatedCertificate(updatedDoc) {\n      return dispatch(_updateObfuscatedCertificate(updatedDoc));\n    },\n    registerTemplates: function registerTemplates(templates) {\n      return dispatch(registerTemplatesAction(templates));\n    },\n    selectTemplateTab: function selectTemplateTab(tabIndex) {\n      return dispatch(selectTemplateTabAction(tabIndex));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DecentralisedRenderer);","map":null,"metadata":{},"sourceType":"module"}